# ุฏููู ุชุตุญูุญ ุฃุฎุทุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช

## โ ุงูุฎุทุฃ: 42P01 - ุงูุฌุฏูู ุบูุฑ ููุฌูุฏ

ูุฐุง ุงูุฎุทุฃ ูุญุฏุซ ุนูุฏูุง ูุญุงูู ุงูุชุทุจูู ุงููุตูู ุฅูู ุฌุฏูู ุบูุฑ ููุฌูุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช.

### ๐ง ุงูุญู ุงููุงูู

#### ุงูุฎุทูุฉ 1: ุชุทุจูู ุฌููุน Migrations

ูู ุจุชุดุบูู ุงูุฃูุงูุฑ ุงูุชุงููุฉ ุจูุฐุง ุงูุชุฑุชูุจ:

```bash
# ูุธู ูุฃุนุฏ ุชุนููู ูุงุนุฏุฉ ุงูุจูุงูุงุช (ุงุญุฐุฑ: ุณูุญุฐู ุฌููุน ุงูุจูุงูุงุช)
npm run db:reset

# ุฃู ุฅุฐุง ููุช ุชุฑูุฏ ุงูุญูุงุธ ุนูู ุงูุจูุงูุงุช:
npm run db:push
```

#### ุงูุฎุทูุฉ 2: ุฅุตูุงุญ ุชุฑุชูุจ ุงูุชูููุฐ

ุงูุชุฃูุฏ ูู ุฃู ุงูู migrations ูุชู ุชุทุจูููุง ุจุงูุชุฑุชูุจ ุงูุชุงูู:

1. **0000_foamy_speed_demon.sql** - ุงูุฌุฏุงูู ุงูุฃุณุงุณูุฉ
2. **0001_reflective_fabian_cortez.sql** - ุฌุฏุงูู ุฅุถุงููุฉ (notifications, ratings, etc)
3. **0002_add_advanced_features.sql** - ุฌุฏุงูู ุงูุณุงุฆููู ูุงููุญุงูุธ ุงููุชูุฏูุฉ
4. **0003_delivery_fee_tables.sql** - ุฌุฏุงูู ุฑุณูู ุงูุชูุตูู
5. **0004_add_offers_fields.sql** - ุฅุถุงูุฉ ุงูุญููู ุงูููููุฏุฉ ููุนุฑูุถ
6. **0005_add_favorites_table.sql** - ุฌุฏูู ุงูููุถูุงุช
7. **0006_add_missing_tables.sql** - ุงูุฌุฏุงูู ุงููุชุจููุฉ (cart, order_tracking, employees, etc)

#### ุงูุฎุทูุฉ 3: ุชุญุฏูุซ ูุชุบูุฑุงุช ุงูุจูุฆุฉ

ุชุฃูุฏ ูู ุฃู `.env` ูุญุชูู ุนูู:

```env
# ูุงุนุฏุฉ ุงูุจูุงูุงุช
DATABASE_URL=postgresql://user:password@localhost:5432/sitesture1

# ุงููุณุคูู ุงูุงูุชุฑุงุถู
DEFAULT_ADMIN_PASSWORD=your_secure_password_here
```

#### ุงูุฎุทูุฉ 4: ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุงุฏู

```bash
# ุฅููุงู ุงูุฎุงุฏู ุงูุญุงูู (Ctrl+C)

# ุชุซุจูุช ุงูู dependencies
npm install

# ุชุดุบูู Migrations
npm run db:push

# ุชุดุบูู ุงูุฎุงุฏู ุจุดูู ุฌุฏูุฏ
npm run dev
```

---

## ๐ ุงูุฌุฏุงูู ุงููููุฉ

### ุงูุฌุฏุงูู ุงูุฃุณุงุณูุฉ:
- โ **users** - ุจูุงูุงุช ุงููุณุชุฎุฏููู
- โ **categories** - ุงูุชุตูููุงุช
- โ **restaurants** - ุงููุชุงุฌุฑ
- โ **menu_items** - ุงูููุชุฌุงุช
- โ **orders** - ุงูุทูุจุงุช

### ุฌุฏุงูู ุงูุนุฑูุถ ูุงูููุถูุงุช:
- โ **special_offers** - ุงูุนุฑูุถ ุงูุฎุงุตุฉ
- โ **favorites** - ุงูููุถูุงุช
- โ **cart** - ุงูุณูุฉ

### ุฌุฏุงูู ุงูุณุงุฆููู:
- โ **drivers** - ุจูุงูุงุช ุงูุณุงุฆููู
- โ **driver_balances** - ุฃุฑุตุฏุฉ ุงูุณุงุฆููู
- โ **driver_earnings_table** - ุฃุฑุจุงุญ ุงูุณุงุฆููู
- โ **driver_transactions** - ูุนุงููุงุช ุงูุณุงุฆููู
- โ **driver_commissions** - ุนูููุงุช ุงูุณุงุฆููู
- โ **driver_withdrawals** - ุนูููุงุช ุงูุณุญุจ

### ุฌุฏุงูู ุงูููุงุฑุฏ ุงูุจุดุฑูุฉ:
- โ **employees** - ุงูููุธููู
- โ **attendance** - ุงูุญุถูุฑ
- โ **leave_requests** - ุทูุจุงุช ุงูุฅุฌุงุฒุฉ

### ุฌุฏุงูู ุฃุฎุฑู:
- โ **system_settings** - ุฅุนุฏุงุฏุงุช ุงููุธุงู
- โ **order_tracking** - ุชุชุจุน ุงูุทูุจุงุช
- โ **notifications** - ุงูุฅุฎุทุงุฑุงุช
- โ **ratings** - ุงูุชููููุงุช
- โ **wallets** - ุงููุญุงูุธ

---

## ๐ ุฎุทูุงุช ุฅุถุงููุฉ ูุชุญุณูู ุงูุฃุฏุงุก

### 1. ุงูุชุญูู ูู ูุฌูุฏ ุงูููุงุฑุณ (Indexes):

```sql
-- ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช ู ุชุดุบูู:
SELECT * FROM pg_stat_user_indexes;
```

### 2. ุชุทุจูู ุงูุจูุงูุงุช ุงูุงูุชุฑุงุถูุฉ:

```bash
# ุชุดุบูู seed script
npm run seed
```

### 3. ุงูุชุญูู ูู ุตุญุฉ ุงูุนูุงูุงุช:

```bash
# ุงูุชุญูู ูู Foreign Keys
npm run db:validate
```

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก ุงูุดุงุฆุนุฉ

### โ ุงูุฎุทุฃ: "relation "categories" does not exist"
**ุงูุญู:** ุฌุฏูู categories ูู ูุชู ุฅูุดุงุคู ุจุนุฏ
```bash
npm run db:push
```

### โ ุงูุฎุทุฃ: "column "category_id" of relation "special_offers" does not exist"
**ุงูุญู:** ุฃุถููุง migration ุฌุฏูุฏ (0004) ูุถูู ูุฐุง ุงูุญูู
```bash
npm run db:push
```

### โ ุงูุฎุทุฃ: "Key (restaurant_id)=(xxx) is not present in table "restaurants""
**ุงูุญู:** ููุงู ูุฑุฌุน ุฎุงุทุฆ ูู ุงูุจูุงูุงุช
```sql
-- ุชูุธูู ุงูุจูุงูุงุช ุงูุชุงููุฉ
DELETE FROM special_offers WHERE restaurant_id IS NOT NULL 
AND restaurant_id NOT IN (SELECT id FROM restaurants);
```

---

## โ ุงูุชุญูู ูู ุงููุฌุงุญ

ุจุนุฏ ุชุทุจูู ุฌููุน ุงูู migrationsุ ูุฌุจ ุฃู ุชุฑู:

```
โ Database migration completed successfully
โ All tables created
โ All indexes created
โ Foreign key constraints applied
```

---

## ๐ ุงูุฏุนู ุงูุฅุถุงูู

ุฅุฐุง ุงุณุชูุฑุช ุงููุดุงูู:

1. **ุงุญุฐู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุฃุนุฏ ุฅูุดุงุคูุง:**
```bash
# ูุง ุชูู ุจูุฐุง ุนูู ูุงุนุฏุฉ ุจูุงูุงุช ุงูุฅูุชุงุฌ!
npm run db:reset
npm run db:push
npm run seed
```

2. **ุชุญูู ูู ุณุฌูุงุช ุงูุฃุฎุทุงุก:**
```bash
# ุนุฑุถ ุณุฌูุงุช PostgreSQL
tail -f /var/log/postgresql/postgresql.log
```

3. **ุชุญูู ูู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช:**
```bash
# ุงุฎุชุจุงุฑ ุงูุงุชุตุงู
psql $DATABASE_URL -c "SELECT 1"
```

---

## ๐ ููุงุญุธุงุช ูููุฉ

- **ุงูุชุงุฑูุฎ:** ุฌููุน ุงูู migrations ุงูุฌุฏูุฏุฉ ุชู ุฅูุดุงุคูุง ูู ูุจุฑุงูุฑ 2026
- **ุงูุฅุตุฏุงุฑ:** ูุชูุงููุฉ ูุน PostgreSQL 12+
- **ุงูุญูุธ ุงูุขูู:** ุชุฃูุฏ ูู ุฃู AUTO BACKUP ููุนู ูุจู ุญุฐู ุงูุจูุงูุงุช
